---
title: "Visualizing OpenPaths.cc data with R"
author: "David Haberth√ºr"
output:
  html_document:
    toc: yes
  pdf_document:
    highlight: zenburn
    toc: yes
---

# Introduction
I tracked my location data with [OpenPaths](http://openpaths.cc) since the beginning of 2014.
OpenPaths comes as an application for your phone, which tracks the its location, uploads it to the OpenPath servers, where you can donate your data for scientific research, and also look at the data yourself.

To do this, we grab a .CSV file with the location data.
Log in to OpenPaths, and click on *CSV* under *Download my data*, which gives you a [comma separated](http://en.wikipedia.org/wiki/Comma-separated_values) list of your location data, which can then visualize with [R](http://www.r-project.org), which is what we've done here.

# Data
We want to plot the location points on a map, which we can do with the wonderful [`ggmap`](http://cran.r-project.org/web/packages/ggmap/) library.
First, we load the CSV file and display a summary of the data.

```{r load CSV and data, message=FALSE}
library(ggmap)
data <- read.csv("openpaths_habi.csv")
whichyear <- 2015
thisyear <- subset(data, grepl(whichyear, data$date)) 
```

```{r display location summary, message=FALSE}
summary(thisyear$lat)
summary(thisyear$lon)
summary(thisyear$alt)
```
In `r whichyear` I was [somewhere close to Huttwil](https://www.google.ch/maps/place/`r mean(thisyear$lat)`,`r mean(thisyear$lon)`) in the mean, and [somewhere in the Emmental](https://www.google.ch/maps/place/`r median(thisyear$lat)`,`r median(thisyear$lon)`) as the median.

```{r display other information CSV and data, message=FALSE}
summary(thisyear$device)
summary(thisyear$os)
```
We see that in `r whichyear` I have only used on phone, the iPhone 5S ([`iPhone6,2`](http://www.everymac.com/ultimate-mac-lookup/?search_keywords=iPhone6,2)) and went through `r sum(summary(thisyear$os) != 0)` different iOS version numbers.
If we assume that I've tracked my location consistently, then I've used iOS `r names(summary(thisyear$os)[which.max(summary(thisyear$os))])` the longest, with `r max(summary(thisyear$os))` saved data points.

# Location data
## Extremes
Interesting points in our data are

  - The minimal and maximal latitudes of `r min(thisyear$lat)` and `r max(thisyear$lat)`, South and North respectively.
  - the minimal and maximal longitudes of `r min(thisyear$lon)` to `r max(thisyear$lon)`, East and West respectively
  - as well as the altitude, which ranges from `r min(thisyear$alt)` [AMSL](https://en.wikipedia.org/wiki/Sea_level) to `r max(thisyear$alt)` AMSL.
  
We can get the extreme points out of the data pretty easily.
To do so, we `subset` the data depending on the value we want to have, construct a Location from these points, grab the map from that location, display this map and add a pointer.

For the northmost point, this goes like so:
```{r where is the northmost point?}
NLocation = c(lon=subset(thisyear, lat==max(thisyear$lat))$lon[1],
              lat=subset(thisyear, lat==max(thisyear$lat))$lat[1])
mapImage<- get_map(location= NLocation, source = 'google', maptype='roadmap', zoom=15)
ggmap(mapImage) +
  geom_point(aes(x = subset(thisyear, lat==max(thisyear$lat))$lon[1],
                 y = subset(thisyear, lat==max(thisyear$lat))$lat[1]),
             alpha = .5,
             color="darkred",
             size = 10) +
  ggtitle(paste("Northmost point in", whichyear))
````
We see that in 2014 I was in [Hamburg](https://www.flickr.com/photos/habi/sets/72157645730536835/), which is the northmost point.
Correctly, the northmost point would be in Oslo, where I spent New Years Eve 2013/2014, but I've only really started to use OpenPaths in mid-January 2014...

The rest of the extremes can be extracted accordingly.

```{r where are the other cardinal direction extremes?, echo=FALSE, message=FALSE}
ELocation = c(lon=subset(thisyear, lon==max(thisyear$lon))$lon[1],
              lat=subset(thisyear, lon==max(thisyear$lon))$lat[1])
mapImage<- get_map(location= ELocation, source = 'google', maptype='roadmap', zoom=15)
ggmap(mapImage) +
  geom_point(aes(x = subset(thisyear, lon==max(thisyear$lon))$lon[1],
                 y = subset(thisyear, lon==max(thisyear$lon))$lat[1]),
             alpha = .5,
             color="darkred",
             size = 10) +
    ggtitle(paste("Most eastern point in", whichyear))

SLocation = c(lon=subset(thisyear, lat==min(thisyear$lat))$lon[1],
              lat=subset(thisyear, lat==min(thisyear$lat))$lat[1])
mapImage<- get_map(location= SLocation, source = 'google', maptype='roadmap', zoom=15)
ggmap(mapImage) +
  geom_point(aes(x = subset(thisyear, lat==min(thisyear$lat))$lon[1],
                 y = subset(thisyear, lat==min(thisyear$lat))$lat[1]),
             alpha = .5,
             color="darkred",
             size = 10) +
    ggtitle(paste("Southhmost point in", whichyear))

WLocation = c(lon=subset(thisyear, lon==min(thisyear$lon))$lon[1],
              lat=subset(thisyear, lon==min(thisyear$lon))$lat[1])
mapImage<- get_map(location= WLocation, source = 'google', maptype='roadmap', zoom=15)
ggmap(mapImage) +
  geom_point(aes(x = subset(thisyear, lon==min(thisyear$lon))$lon[1],
                 y = subset(thisyear, lon==min(thisyear$lon))$lat[1]),
             alpha = .5,
             color="darkred",
             size = 10) +
    ggtitle(paste("Most western point in", whichyear))
````

The most eastern point was (unsurprisingly) in [Japan](https://www.flickr.com/photos/habi/sets/72157644608251866/), the most southern point in [Cyprus](https://www.flickr.com/photos/habi/sets/72157649175258515/) and the most eastern point in Amsterdam, while flying to Japan.

The highest in `r whichyear` was on the Bettmerhorn, while skiing.
The lowest point at `r min(thisyear$alt)` AMSL was at home and is probably a fluke in the GPS thisyear :)

```{r where is the highest point?, echo=FALSE, message=FALSE}
HighestLocation = c(lon=subset(thisyear, alt==max(thisyear$alt))$lon[1],
                    lat=subset(thisyear, alt==max(thisyear$alt))$lat[1])
mapImage<- get_map(location = HighestLocation,
                   source = 'google',
                   maptype='roadmap',
                   zoom=15)
ggmap(mapImage) +
  geom_point(aes(x = subset(thisyear, alt==max(thisyear$alt))$lon[1],
                 y = subset(thisyear, alt==max(thisyear$alt))$lat[1]),
             alpha = .5,
             color="darkred",
             size = 10) +
    ggtitle(paste("Highest point in", whichyear))
````

# Where was I in Switzerland?
To plot the obtained data on a map, we have to center the resulting map location.
Since I only want to show the data points in Switzerland, we center the map on that.
Afterwards, we can simply plot all the `thisyear` geolocation points on top of that image, and you can see where I was in Switzerland in `r whichyear`.

```{r Swiss Locations, message=FALSE, warning=FALSE}
HomeBase <- get_map(location= 'Switzerland',
                    source = 'google',
                    maptype='roadmap',
                    zoom=7)
AllPoints <- data.frame(lon=thisyear$lon,
                            lat = thisyear$lat)
ggmap(HomeBase) + geom_point(aes(x = lon,
                                 y = lat),
                             data = AllPoints,
                             size = 3,
                             alpha = 0.25)
```
